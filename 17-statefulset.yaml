apiVersion: v1 
kind: Service  
metadata: 
    name: nginx-svc-headless
    labels: 
       purpose: statefulset 
       project: roboshop 
spec: 
   ports: 
   - protocol: TCP 
     port: 80 
     name: web 
   clusterIP: None 
   selector: 
      purpose: nginx-svc-headless 
      project: roboshop 
--- 
apiVersion: v1 
kind: Service
metadata: 
   name: nginx-svc-normal 
   labels: 
      purpose: statefulset 
      project: roboshop 
spec: 
   ports: 
   - protocol: TCP
     port: 80 
     name: web                      
   selector: 
     purpose: statefulset 
     project: roboshop 
--- 
apiVersion: apps/v1 
kind: StatefulSet 
metadata: 
     name: nginx-statefulset 
spec:
   replicas: 3 #by default it takes 1 if u wont provide 
   selector: 
       matchLabels: 
           purpose: statefulset 
           project: roboshop 
   # this is pod definition 
   template: 
      metadata: 
         labels: 
             purpose: statefulset 
             project: roboshop 
      spec: 
        containers: 
        - name: nginx 
          image: nginx      
          volumeMounts: 
          - name: www 
            mountPath: /usr/share/nginx/html 
# This is nothing but pvc you can create directly here or else you can create seperately 
   volumeClaimTemplates: 
   - metadata: 
        name: www 
     spec:  
       accessModes: 
       - ReadWriteOnce 
       storageClassName: "efs-roboshop" 
       resources: 
          requests: 
             storage: 2Gi              